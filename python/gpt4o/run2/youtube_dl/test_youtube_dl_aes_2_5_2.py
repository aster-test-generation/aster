import unittest
from youtube_dl.aes import aes_cbc_decrypt


class TestAESFunctions(unittest.TestCase):
    def test_aes_decrypt(self):
        data = bytes([0x32, 0x88, 0x31, 0xe0, 0x43, 0x5a, 0x31, 0x37, 0xf6, 0x30, 0x98, 0x07, 0xa8, 0x8d, 0xa2, 0x34])
        expanded_key = bytes([0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x4d, 0x4d, 0x9a, 0x9a, 0x9a, 0x9a,
                              0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x4d, 0x4d, 0x9a, 0x9a, 0x9a, 0x9a,
                              0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x4d, 0x4d, 0x9a, 0x9a, 0x9a, 0x9a])
        result = aes_decrypt(data, expanded_key)
        expected = bytes([0x32, 0x88, 0x31, 0xe0, 0x43, 0x5a, 0x31, 0x37, 0xf6, 0x30, 0x98, 0x07, 0xa8, 0x8d, 0xa2, 0x34])
        self.assertEqual(result, expected)

    def test_xor(self):
        data1 = bytes([0x32, 0x88, 0x31, 0xe0])
        data2 = bytes([0x43, 0x5a, 0x31, 0x37])
        result = xor(data1, data2)
        expected = bytes([0x71, 0xd2, 0x00, 0xd7])
        self.assertEqual(result, expected)

    def test_sub_bytes_inv(self):
        data = bytes([0x7a, 0x89, 0x2b, 0x3d])
        result = sub_bytes_inv(data)
        expected = bytes([0x16, 0x3c, 0x4d, 0x5e])
        self.assertEqual(result, expected)

    def test_shift_rows_inv(self):
        data = bytes([0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e, 0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e])
        result = shift_rows_inv(data)
        expected = bytes([0x7a, 0x3c, 0x2b, 0x5e, 0x16, 0x89, 0x4d, 0x3d, 0x7a, 0x3c, 0x2b, 0x5e, 0x16, 0x89, 0x4d, 0x3d])
        self.assertEqual(result, expected)

    def test_mix_columns_inv(self):
        data = bytes([0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e, 0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e])
        result = mix_columns_inv(data)
        expected = bytes([0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e, 0x7a, 0x89, 0x2b, 0x3d, 0x16, 0x3c, 0x4d, 0x5e])
        self.assertEqual(result, expected)

if __name__ == '__main__':
    unittest.main()